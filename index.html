<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Magistral LP‑GP Finder v2</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <style>
  :root{--blue:#013463;--teal:#00958f;--grey:#687683;--bg:#f5f7fa;--white:#fff;--border:#d6dde5;--shadow:0 2px 6px rgba(0,0,0,.08);--font:"Inter",system-ui,-apple-system,"Segoe UI",sans-serif}
  *{box-sizing:border-box;margin:0;padding:0}
  body{font-family:var(--font);background:var(--bg);color:#1f2d3d;display:flex;min-height:100vh;overflow:hidden}
  a{color:var(--blue);text-decoration:none}
  .sidebar{flex:0 0 310px;background:var(--white);border-right:1px solid var(--border);padding:22px;display:flex;flex-direction:column;gap:26px;overflow:auto}
  .main{flex:1;display:flex;flex-direction:column;padding:22px;position:relative}
  .panel{background:var(--white);border:1px solid var(--border);border-radius:10px;padding:20px;box-shadow:var(--shadow)}
  .panel h2{font-size:18px;font-weight:700;margin-bottom:12px;color:var(--blue);border-bottom:1px solid var(--border);padding-bottom:8px}
  .btn{border:none;border-radius:6px;padding:10px 14px;font-size:14px;font-weight:600;cursor:pointer;transition:.2s;width:100%;line-height:1.25;text-align:center}
  .btn-pri{background:var(--teal);color:#fff}.btn-pri:hover{background:#007c77}
  .btn-sec{background:var(--grey);color:#fff}.btn-sec:hover{background:#556270}
  .filter-buttons{display:grid;grid-template-columns:repeat(5,1fr);gap:6px}
  .filter-buttons .btn{padding:6px 0;font-size:13px;background:#e9edf2;color:#344454;border:1px solid transparent}
  .filter-buttons .active{background:var(--blue);color:#fff}
  input,select{width:100%;padding:9px 11px;border:1px solid var(--border);border-radius:6px;font-size:14px;background:var(--white)}
  input:focus,select:focus{outline:none;border-color:var(--teal);box-shadow:0 0 0 2px rgba(0,149,143,.25)}
  .table-wrap{flex:1;background:var(--white);border:1px solid var(--border);border-radius:10px;overflow:auto;box-shadow:var(--shadow)}
  .table{width:100%;min-width:1400px;border-collapse:collapse;font-size:13px;table-layout:fixed}
  th,td{padding:8px 10px;border-bottom:1px solid var(--border);white-space:nowrap;text-overflow:ellipsis;overflow:hidden}
  th{background:var(--bg);color:var(--blue);font-weight:600;text-transform:uppercase;position:sticky;top:0;z-index:3}
  tr:hover td{background:#f0f4f8}
  .row-new{background:#fffbe7}
  .icon{cursor:pointer;font-size:16px;color:var(--blue);margin-right:8px}
  .icon.del{color:#b60000}
  #overlay{position:absolute;inset:0;display:none;align-items:center;justify-content:center;background:rgba(255,255,255,.55);z-index:300}
  .spinner{width:44px;height:44px;border:5px solid rgba(0,0,0,.12);border-top-color:var(--teal);border-radius:50%;animation:spin 1s linear infinite}@keyframes spin{to{transform:rotate(360deg)}}
  #toast{position:fixed;top:22px;right:24px;z-index:600}
  .toast{padding:11px 17px;border-radius:8px;color:#fff;font-weight:600;margin-bottom:10px;box-shadow:var(--shadow);opacity:0;transform:translateY(-10px);transition:.3s}
  .toast.show{opacity:1;transform:none}.toast.ok{background:var(--teal)}.toast.err{background:#c0392b}
  .modal{position:fixed;inset:0;background:rgba(0,0,0,.45);display:none;align-items:center;justify-content:center;z-index:500}
  .modal-box{background:#fff;border-radius:10px;padding:24px;width:92%;max-width:820px;max-height:85%;overflow:auto;box-shadow:var(--shadow)}
  .modal-box h3{font-size:18px;font-weight:700;margin-bottom:14px;color:var(--blue)}
  .modal-box table{width:100%;border-collapse:collapse;font-size:14px}
  .modal-box th,.modal-box td{padding:8px 10px;border-bottom:1px solid var(--border)}
  #col-list li{display:flex;align-items:center;gap:6px;margin-bottom:6px}
  .manage-btn{margin-bottom:10px}
  /* Updated Styles for Quick Filters Alignment */
  .panel.quick-filters select { margin-bottom: 10px; }
  .panel.quick-filters label { display: block; font-size: 13px; margin-bottom: 4px; }
  .panel.quick-filters .filter-group { display: flex; gap: 8px; align-items: center; margin-bottom: 8px; }
  </style>
</head>
<body>
<aside class="sidebar">
  <div class="panel"><h2>View</h2>
    <div class="filter-buttons"><button class="btn active" data-f="All">All</button><button class="btn" data-f="LP">LPs</button><button class="btn" data-f="GP">GPs</button><button class="btn" data-f="Broker">Brokers</button><button class="btn" data-f="Other">Others</button></div>
    <button id="col-btn" class="btn btn-sec" style="margin-top:14px">Configure Columns</button>
  </div>
  <div class="panel quick-filters"><h2>Quick Filters</h2>
      <div class="filter-group"><label for="q-country">Country</label><select id="q-country"><option value="">All</option></select></div>
      <div class="filter-group"><label for="q-sector">Sector</label><select id="q-sector"><option value="">All</option></select></div>
      <div class="filter-group"><label for="q-stage">Stage</label><select id="q-stage"><option value="">All</option></select></div>
      <button id="q-clear" class="btn btn-sec">Clear</button>
  </div>
  <div class="panel"><h2>AI Discovery</h2>
    <label style="font-size:13px">Entity Type</label><select id="ai-type"><option>LP</option><option>GP</option><option>Broker</option><option>Other</option></select>
    <label style="font-size:13px;margin-top:12px">Specific Type</label><input id="ai-sub" placeholder="Family Office" />
    <label style="font-size:13px;margin-top:12px">Sector</label><input id="ai-sec" placeholder="Health Care" />
    <label style="font-size:13px;margin-top:12px">Geography</label><input id="ai-geo" placeholder="USA" />
    <button id="ai-btn" class="btn btn-pri" style="margin-top:16px">✨ Find Investors</button>
  </div>
  <div class="panel"><h2>Manage List</h2>
    <label class="btn btn-sec manage-btn" for="file-in">Upload Excel/CSV</label><input type="file" id="file-in" accept=".xlsx,.xls,.csv" hidden />
    <button id="exp-btn" class="btn btn-sec">Export CSV</button>
  </div>
</aside>
<main class="main">
  <div id="overlay"><div class="spinner"></div></div>
  <input id="search" placeholder="Search…" style="padding:9px 12px;border:1px solid var(--border);border-radius:6px;width:100%;margin-bottom:12px" />
  <div class="table-wrap"><table class="table"><thead id="thead"></thead><tbody id="tbody"></tbody></table><p id="empty" style="text-align:center;padding:32px;color:#8d99a6">Upload a file or use AI Discovery to get started.</p></div>
</main>
<div id="toast"></div>
<div class="modal" id="col-modal"><div class="modal-box" style="width:360px"><h3>Visible Columns</h3><ul id="col-list" style="list-style:none;padding-left:0;max-height:380px;overflow:auto"></ul><button class="btn btn-pri close" style="margin-top:14px;width:100%">Done</button></div></div>
<div class="modal" id="ct-modal"><div class="modal-box"><h3 id="ct-title">Contacts</h3><table><thead><tr><th>Name</th><th>Designation</th><th>Email</th><th>LinkedIn</th></tr></thead><tbody id="ct-body"></tbody></table><button class="btn btn-pri close" style="margin-top:16px;width:120px">Close</button></div></div>
<script>
(() => {
  /* ---------- STATE & CONSTANTS ---------- */
  const COLS = [
    { key: 'sn', label: '#' },
    { key: 'entityType', label: 'LP/GP/Broker' },
    { key: 'firmName', label: 'Firm Name' },
    { key: 'subType', label: 'Type' },
    { key: 'address', label: 'Address' },
    { key: 'country', label: 'Country' },
    { key: 'website', label: 'Website' },
    { key: 'companyLinkedIn', label: 'Firm LinkedIn' },
    { key: 'about', label: 'About' },
    { key: 'investmentStrategy', label: 'Strategy' },
    { key: 'sector', label: 'Sector' },
    { key: 'sectorDetails', label: 'Sector Details' },
    { key: 'stage', label: 'Stage' },
    { key: 'source', label: 'Source' },
    { key: 'actions', label: '' }
  ];
  const alias = { /*...*/ };
  const contactKeys = new Set(['contactName', 'designation', 'linkedIn', 'email', 'contactNumber']);
  let firms = [], filter = 'All';
  const visible = new Set(['sn','entityType','firmName','subType','address','country','website','companyLinkedIn','about','investmentStrategy','sector','sectorDetails','stage','source','actions']);

  /* ---------- DOM ---------- */
  const $ = q => document.querySelector(q), $$ = q => document.querySelectorAll(q);
  const UI = { /*...*/ };

  /* ---------- UTIL ---------- */
  const showOverlay = flag => UI.overlay.style.display = flag ? 'flex' : 'none';
  const toast = (msg, ok = true) => { /*...*/ };
  const mapKey = k => alias[k.toLowerCase().trim()] || k.trim().replace(/\s+/g, '');
  const populateSelect = (sel, vals) => { /*...*/ };

  /* ---------- RENDER ---------- */
  function rebuildFilters() { /*...*/ }
  function render() { /*...*/ }

  /* ---------- EVENT BINDINGS ---------- */
  UI.filterBtns.forEach(b => b.addEventListener('click', () => { /*...*/ }));
  UI.search.addEventListener('input', render);
  [UI.qCountry, UI.qSector, UI.qStage].forEach(sel => sel.addEventListener('change', render));
  $('#q-clear').addEventListener('click', () => { UI.qCountry.value = UI.qSector.value = UI.qStage.value = ''; render(); });

  /* COLUMN MODAL */
  UI.colBtn.addEventListener('click', () => { /* build list */ UI.colModal.style.display = 'flex'; });
  UI.colModal.addEventListener('click', e => { if (e.target===UI.colModal||e.target.classList.contains('close')) UI.colModal.style.display='none'; });
  UI.colList.addEventListener('change', e => { const k=e.target.dataset.k; e.target.checked?visible.add(k):visible.delete(k); render(); });

  /* CONTACT & DELETE */
  UI.tbody.addEventListener('click', e => { /*...*/ });
  UI.ctModal.addEventListener('click', e => { if(e.target===UI.ctModal||e.target.classList.contains('close')) UI.ctModal.style.display='none'; });

  /* UPLOAD */
  $('#file-in').addEventListener('change', e => {
    const file = e.target.files[0]; if(!file) return; showOverlay(true);
    document.addEventListener('DOMContentLoaded', () => {
      const reader = new FileReader();
      reader.onload = ev => { /* process upload */ };
      reader.onerror = () => { showOverlay(false); toast('Could not read file', false); };
      reader.readAsArrayBuffer(file);
    });
  });

  /* EXPORT */
  $('#exp-btn').addEventListener('click', () => {/*...*/});

  /* INIT */
  rebuildFilters(); render();
})();
</script>
</body>
</html>
